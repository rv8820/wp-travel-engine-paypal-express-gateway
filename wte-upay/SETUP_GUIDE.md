# WP Travel Engine - UPay Gateway Setup Guide

## üìã Overview

This guide will walk you through setting up the Union Bank UPay payment gateway for WP Travel Engine.

## üéØ Prerequisites

Before you begin, ensure you have:

1. ‚úÖ WordPress 5.0 or higher installed
2. ‚úÖ WP Travel Engine 5.0 or higher installed and activated
3. ‚úÖ PHP 7.4 or higher
4. ‚úÖ SSL certificate installed (required for production)
5. ‚úÖ Union Bank UPay merchant account

---

## üì¶ Step 1: Union Bank Developer Portal Setup

### Create Developer Account

1. **Register at Union Bank Developer Portal:**
   - **UAT (Testing)**: https://developer-uat.unionbankph.com
   - **Production**: https://developer.unionbankph.com

2. **Create an Application:**
   - Log in to the Developer Portal
   - Click "Create Application" or "New App"
   - Fill in application details:
     - Application Name: `Your Site Name - WP Travel Engine`
     - Description: `Payment gateway for travel bookings`
     - Callback URL: `https://yoursite.com` (your site URL)

3. **Subscribe to UPay API Product:**
   - Go to API Products
   - Search for "UPay by UnionBank (1.0.0)"
   - Click "Subscribe"
   - Select your application
   - Confirm subscription

4. **Get Your Credentials:**
   - Go to your Application details
   - Copy these credentials (you'll need them later):
     ```
     ‚úì Client ID (X-IBM-Client-Id)
     ‚úì Client Secret (X-IBM-Client-Secret)
     ```

5. **Get Partner ID:**
   - Contact Union Bank support
   - Request your Partner ID (X-Partner-Id)
   - This is generated by Union Bank for your merchant account

6. **Get Biller UUID:**
   - Contact Union Bank support
   - Request your Biller UUID
   - This identifies your biller account in the UPay system

---

## üîß Step 2: Plugin Installation

### Method 1: Manual Installation (Recommended)

1. **Download the plugin:**
   - Download `wte-upay.zip` from your source

2. **Upload to WordPress:**
   ```
   - Go to WordPress Admin ‚Üí Plugins ‚Üí Add New
   - Click "Upload Plugin"
   - Choose the wte-upay.zip file
   - Click "Install Now"
   - Click "Activate"
   ```

### Method 2: FTP Installation

1. **Extract the zip file**
2. **Upload via FTP:**
   ```
   - Connect to your server via FTP
   - Navigate to /wp-content/plugins/
   - Upload the wte-upay folder
   - Go to WordPress Admin ‚Üí Plugins
   - Activate "WP Travel Engine - UPay Gateway"
   ```

---

## ‚öôÔ∏è Step 3: Plugin Configuration

### Enable Test Mode (Recommended for Initial Setup)

1. **Edit wp-config.php:**
   ```php
   // Add this line before "/* That's all, stop editing! */"
   define( 'WP_TRAVEL_ENGINE_PAYMENT_DEBUG', true );
   ```

2. **Save the file**

   This will use Union Bank's UAT (test) environment.

### Configure Plugin Settings

1. **Navigate to Settings:**
   ```
   WordPress Admin ‚Üí WP Travel Engine ‚Üí Settings ‚Üí Payment
   ```

2. **Enable UPay Gateway:**
   - Find "UPay Payment" checkbox
   - Check the box to enable
   - Click "Save Changes"

3. **Enter UPay Credentials:**
   - Go to "UPay Settings" tab
   - Enter the following information:

   | Field | Description | Example |
   |-------|-------------|---------|
   | **Client ID** | Your X-IBM-Client-Id from Developer Portal | `a1b2c3d4e5f6...` |
   | **Client Secret** | Your X-IBM-Client-Secret from Developer Portal | `x9y8z7w6v5u4...` |
   | **Partner ID** | Partner ID from Union Bank | `PARTNER123` |
   | **Biller UUID** | Your Biller UUID from Union Bank | `5F3DDD5B-95E3-...` |

4. **Save Settings**

---

## üß™ Step 4: Testing (UAT Environment)

### Test the Payment Flow

1. **Create a Test Trip:**
   - Go to WP Travel Engine ‚Üí Trips ‚Üí Add New
   - Create a simple test trip
   - Set a low price (e.g., ‚Ç±100)
   - Publish the trip

2. **Make a Test Booking:**
   - Visit your trip page on the frontend
   - Click "Book Now"
   - Fill in booking details
   - Select "UPay Payment" as payment method
   - Complete the booking

3. **Verify Payment Process:**
   - You should see:
     ‚úì Redirect to UPay payment page OR
     ‚úì QR code for InstaPay payment
   - Complete the payment in test environment
   - You should be redirected back to your site

4. **Check Booking Status:**
   - Go to WP Travel Engine ‚Üí Bookings
   - Find your test booking
   - Verify payment status is "Completed"
   - Check for UPay Payment Details in the side panel

### Enable Debug Logging

1. **Add to wp-config.php:**
   ```php
   define( 'WP_DEBUG', true );
   define( 'WP_DEBUG_LOG', true );
   define( 'WP_DEBUG_DISPLAY', false );
   ```

2. **Check logs:**
   - View `/wp-content/debug.log`
   - Look for entries starting with "UPay API"

---

## üöÄ Step 5: Go Live (Production)

### Switch to Production

1. **Remove or Set Test Mode to False:**
   ```php
   // In wp-config.php, change:
   define( 'WP_TRAVEL_ENGINE_PAYMENT_DEBUG', false );
   
   // Or remove the line entirely
   ```

2. **Update Credentials:**
   - Get production credentials from https://developer.unionbankph.com
   - Update Client ID, Client Secret, Partner ID in plugin settings
   - Verify Biller UUID is correct for production

3. **Verify SSL Certificate:**
   ```
   - Ensure your site has a valid SSL certificate
   - Site should be accessible via https://
   - Test SSL using: https://www.ssllabs.com/ssltest/
   ```

4. **Test Again:**
   - Make a real test transaction (small amount)
   - Verify payment completes successfully
   - Check booking confirmation email

### Security Checklist

- ‚úÖ SSL certificate installed and valid
- ‚úÖ Production credentials entered
- ‚úÖ Test mode disabled
- ‚úÖ Debug mode disabled (for production)
- ‚úÖ Backup of your site created
- ‚úÖ Email notifications working

---

## üîç Step 6: Verification

### Test Complete Payment Flow

1. **Customer Journey:**
   ```
   1. Customer visits trip page
   2. Customer clicks "Book Now"
   3. Customer fills booking form
   4. Customer selects UPay payment
   5. Customer submits booking
   6. Customer redirected to UPay payment page
   7. Customer completes payment
   8. Customer redirected back to your site
   9. Customer sees confirmation message
   10. Customer receives confirmation email
   ```

2. **Admin Verification:**
   ```
   1. Check booking in admin panel
   2. Verify payment status
   3. Check UPay transaction ID
   4. Verify email was sent
   5. Check payment amount matches
   ```

---

## üìä Understanding Payment Status

| Status | Meaning | Action Required |
|--------|---------|----------------|
| **Pending** | Payment initiated but not completed | Wait or follow up with customer |
| **Completed** | Payment successful | No action needed |
| **Failed** | Payment failed | Customer needs to retry |
| **Cancelled** | Customer cancelled payment | Customer needs to retry |

---

## üõ†Ô∏è Troubleshooting

### Common Issues

#### 1. "Invalid credentials" error

**Solution:**
- Verify Client ID and Client Secret are correct
- Check if you're using UAT credentials in test mode
- Ensure no extra spaces in credentials

#### 2. Payment not completing

**Solution:**
- Check if callback URL is accessible
- Verify Biller UUID is correct
- Check debug.log for errors
- Ensure SSL is working

#### 3. Booking status not updating

**Solution:**
- Check if callback URL is being called
- Verify transaction ID is being stored
- Check debug logs for API responses

#### 4. QR Code not displaying

**Solution:**
- Verify payment method is set to "instapay"
- Check if qrCode is in API response
- View debug log for API response

### Debug Mode

Enable comprehensive logging:

```php
// wp-config.php
define( 'WP_TRAVEL_ENGINE_PAYMENT_DEBUG', true );
define( 'WP_DEBUG', true );
define( 'WP_DEBUG_LOG', true );
```

Check logs:
```
/wp-content/debug.log
```

---

## üìû Support

### Plugin Support
- GitHub Issues: [Create an issue]
- Email: support@yourcompany.com

### Union Bank Support
- Developer Portal: https://developer.unionbankph.com
- Email: apisupport@unionbankph.com

### WP Travel Engine Support
- Documentation: https://docs.wptravelengine.com
- Support: https://wptravelengine.com/support

---

## üìù Additional Notes

### Payment Methods Supported by UPay

- **InstaPay** - Real-time bank transfer with QR code
- **UnionBank Online** - Online banking
- **PESONet** - Batch bank transfer
- **Over-the-Counter** - Payment centers
- **E-Wallets** - GCash, PayMaya, etc.

### Transaction Limits

Check with Union Bank for current limits:
- InstaPay: Usually up to ‚Ç±50,000 per transaction
- Varies by payment method

### Fees

- Convenience fees may apply
- Varies by payment channel
- Shown to customer before payment

---

## ‚úÖ Launch Checklist

Before going live, ensure:

- [ ] UAT testing completed successfully
- [ ] Production credentials configured
- [ ] SSL certificate installed and valid
- [ ] Test transaction completed in production
- [ ] Confirmation emails working
- [ ] Booking status updates correctly
- [ ] Admin can view payment details
- [ ] Debug mode disabled
- [ ] Site backup created
- [ ] Terms and conditions updated
- [ ] Privacy policy updated
- [ ] Customer support ready

---

## üéâ You're Ready!

Your UPay payment gateway is now configured and ready to accept payments!

**Need help?** Refer to the troubleshooting section or contact support.

**Happy selling! üöÄ**
